name: UNIT-TESTING

on:
  workflow_dispatch:
    inputs:
      debug:
        description: 'Enable debugging logs'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  unit-test:
    name: Unit Testing
    runs-on: self-hosted
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify runner environment
        run: |
          echo "Running on self-hosted runner"
          echo "Java version:"
          java -version
          echo "Maven version:"
          mvn --version

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Cache Maven packages
        uses: actions/cache@v4
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-m2-

      - name: Run Tests
        run: mvn test -B ${{ github.event.inputs.debug == 'true' && '-X' || '' }}
        
      - name: Test Summary
        if: always()
        run: |
          echo "Test execution completed"
          # Check if surefire reports exist and display summary
          if [ -d "target/surefire-reports" ]; then
            echo "Test reports available at target/surefire-reports"
            find target/surefire-reports -name "*.txt" -exec cat {} \; | grep "Tests run:"
          else 
            echo "No test reports found"
          fi
